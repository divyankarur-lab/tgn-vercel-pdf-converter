<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TGN Agreement PDF Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .generator-container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .status { 
            padding: 10px; 
            border-radius: 4px; 
            margin: 10px 0; 
            text-align: center;
        }
        .loading { background: #e3f2fd; color: #1976d2; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .error { background: #ffebee; color: #c62828; }
        #content { 
            border: 5px solid #34C759; 
            padding: 30px; 
            margin: 20px 0;
            background: white;
            font-family: Arial, sans-serif;
            max-width: 700px; /* Prevent content from being too wide */
            box-sizing: border-box;
        }
        #content img { 
            width: 100px; 
            height: auto; 
            display: block; 
            margin: 0 auto 20px;
        }
        #content h1 { 
            text-align: center; 
            font-size: 40px; 
            color: #1c1c1c; 
            margin: 0 0 20px 0;
        }
        #content .goodwill { color: #34C759; }
        #content hr { 
            border: 0; 
            height: 1px; 
            background: #e0e5ec; 
            margin: 20px 0; 
        }
        #content p { 
            font-size: 18px; 
            line-height: 1.5; 
            margin: 15px 0;
        }
        button {
            background: #34C759;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #2da94b; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .input-group {
            margin: 20px 0;
        }
        label {
            display: block;
            margin: 10px 0 5px 0;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="generator-container">
        <h1>üìÑ TGN Agreement PDF Generator</h1>
        <div id="status" class="status loading">‚úÖ Ready to generate PDF</div>
        
        <div class="input-group">
            <label for="freelancerName">Freelancer Name:</label>
            <input type="text" id="freelancerName" value="John Smith" placeholder="Enter freelancer name">
        </div>
        
        <div class="input-group">
            <label for="producerName">Producer Name:</label>
            <input type="text" id="producerName" value="Jane Producer" placeholder="Enter producer name">
        </div>
        
        <div class="input-group">
            <label for="projectDetails">Project Details:</label>
            <textarea id="projectDetails" placeholder="Enter project details (optional)">Web development project for e-commerce platform including frontend and backend development.</textarea>
        </div>
        
        <button onclick="generatePDF()" id="generateBtn">üìÑ Generate PDF</button>
        <button onclick="updatePreview()" id="previewBtn">üëÄ Update Preview</button>
        <button onclick="generatePDFNoImages()" id="testBtn" style="background: #ff6b6b;">üß™ Test PDF (No Images)</button>
        
        <div id="content">
            <!-- Temporarily removed problematic external image -->
            <!-- <img src="https://ik.imagekit.io/divyankarur/o__2_-removebg-preview.png?updatedAt=1755246312760" alt="TGN Logo"> -->
            <div style="text-align: center; margin-bottom: 20px; color: #34C759; font-size: 24px; font-weight: bold;">
                üåü THE GOOD WILL NETWORK üåü
            </div>
            <h1>the <span class="goodwill">goodwill</span> agreement</h1>
            <hr>
            <p><strong>Freelancer:</strong> <span id="preview-freelancer">John Smith</span></p>
            <p><strong>Producer:</strong> <span id="preview-producer">Jane Producer</span></p>
            <p><strong>Project:</strong> <span id="preview-project">Web development project for e-commerce platform including frontend and backend development.</span></p>
            <hr>
            <p>This Agreement establishes the terms and conditions for collaboration between the above parties in accordance with The Good Will Network's principles of mutual respect, fair compensation, and professional excellence.</p>
            <p>Both parties agree to maintain open communication, deliver quality work, and uphold the values of integrity and goodwill throughout the project duration.</p>
        </div>
    </div>

    <script>
        // Update preview with form data
        function updatePreview() {
            document.getElementById('preview-freelancer').textContent = 
                document.getElementById('freelancerName').value || 'Freelancer Name';
            document.getElementById('preview-producer').textContent = 
                document.getElementById('producerName').value || 'Producer Name';  
            document.getElementById('preview-project').textContent = 
                document.getElementById('projectDetails').value || 'Project details to be specified';
        }

        // Generate PDF function - DIRECT html2canvas + jsPDF approach
        async function generatePDF() {
            try {
                document.getElementById('status').innerHTML = 'üîÑ Generating PDF...';
                document.getElementById('status').className = 'status loading';
                document.getElementById('generateBtn').disabled = true;
                
                // Update preview first
                updatePreview();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const contentDiv = document.getElementById('content');
                console.log('Content dimensions:', contentDiv.offsetWidth, 'x', contentDiv.offsetHeight);
                
                // Use html2canvas directly
                console.log('Creating canvas from content...');
                const canvas = await html2canvas(contentDiv, {
                    scale: 2, // Higher quality
                    useCORS: true,
                    allowTaint: true,
                    logging: true,
                    width: contentDiv.offsetWidth,
                    height: contentDiv.offsetHeight,
                    scrollX: 0,
                    scrollY: 0,
                    backgroundColor: '#ffffff'
                });
                
                console.log('Canvas created:', canvas.width, 'x', canvas.height);
                
                // Create PDF with jsPDF
                const { jsPDF } = window.jspdf;
                
                // A4 dimensions in mm
                const pdfWidth = 210; 
                const pdfHeight = 297;
                
                // Calculate scaling to fit content in PDF
                const contentWidth = canvas.width / 2; // Divide by scale
                const contentHeight = canvas.height / 2; // Divide by scale
                
                // Add margins
                const margin = 15; // 15mm margin
                const availableWidth = pdfWidth - (margin * 2);
                const availableHeight = pdfHeight - (margin * 2);
                
                // Scale to fit within available space
                const scaleX = availableWidth / contentWidth;
                const scaleY = availableHeight / contentHeight;
                const scale = Math.min(scaleX, scaleY, 1); // Don't scale up
                
                const finalWidth = contentWidth * scale;
                const finalHeight = contentHeight * scale;
                
                console.log('PDF scaling:', scale, 'Final size:', finalWidth, 'x', finalHeight);
                
                // Create PDF
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // Add canvas as image to PDF
                const imgData = canvas.toDataURL('image/jpeg', 0.95);
                pdf.addImage(imgData, 'JPEG', margin, margin, finalWidth, finalHeight);
                
                // Save PDF
                pdf.save('goodwill-agreement.pdf');
                console.log('PDF saved successfully!');
                
                document.getElementById('status').innerHTML = 'üéâ PDF generated and downloaded successfully!';
                document.getElementById('status').className = 'status success';
                document.getElementById('generateBtn').disabled = false;
                
            } catch (error) {
                console.error('PDF generation error:', error);
                document.getElementById('status').innerHTML = '‚ùå Error: ' + error.message;
                document.getElementById('status').className = 'status error';
                document.getElementById('generateBtn').disabled = false;
            }
        }
        
        // Debug function using html2canvas + jsPDF directly
        async function generatePDFNoImages() {
            try {
                document.getElementById('status').innerHTML = 'üîÑ Generating test PDF...';
                document.getElementById('status').className = 'status loading';
                
                // Create a simple test div
                const testDiv = document.createElement('div');
                testDiv.style.width = '600px';
                testDiv.style.height = '400px';
                testDiv.style.backgroundColor = 'white';
                testDiv.style.border = '3px solid #34C759';
                testDiv.style.padding = '30px';
                testDiv.style.fontFamily = 'Arial, sans-serif';
                testDiv.style.position = 'absolute';
                testDiv.style.top = '0';
                testDiv.style.left = '0';
                testDiv.style.zIndex = '9999';
                
                testDiv.innerHTML = `
                    <h1 style="color: #34C759; text-align: center; font-size: 32px; margin: 0 0 20px 0;">
                        TEST AGREEMENT
                    </h1>
                    <hr style="border: none; height: 2px; background: #34C759; margin: 20px 0;">
                    <p style="font-size: 16px; margin: 15px 0; color: black;">
                        <strong>Freelancer:</strong> ${document.getElementById('freelancerName').value || 'Test Freelancer'}
                    </p>
                    <p style="font-size: 16px; margin: 15px 0; color: black;">
                        <strong>Producer:</strong> ${document.getElementById('producerName').value || 'Test Producer'}
                    </p>
                    <p style="font-size: 14px; margin: 15px 0; color: black;">
                        This is a simple test to verify PDF generation works correctly.
                    </p>
                `;
                
                document.body.appendChild(testDiv);
                console.log('Test div created, dimensions:', testDiv.offsetWidth, 'x', testDiv.offsetHeight);
                
                // Wait a moment for rendering
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Create canvas
                console.log('Creating test canvas...');
                const canvas = await html2canvas(testDiv, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    logging: true
                });
                
                console.log('Test canvas created:', canvas.width, 'x', canvas.height);
                
                // Create PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // Add image to PDF (simple approach)
                const imgData = canvas.toDataURL('image/jpeg', 0.95);
                pdf.addImage(imgData, 'JPEG', 10, 10, 190, 0); // Auto height
                
                // Save
                pdf.save('test-simple.pdf');
                console.log('Test PDF saved!');
                
                // Clean up
                document.body.removeChild(testDiv);
                
                document.getElementById('status').innerHTML = 'üéâ Test PDF generated successfully!';
                document.getElementById('status').className = 'status success';
                
            } catch (error) {
                console.error('Test PDF error:', error);
                document.getElementById('status').innerHTML = '‚ùå Test failed: ' + error.message;
                document.getElementById('status').className = 'status error';
            }
        }

        // Auto-update preview when typing
        document.getElementById('freelancerName').addEventListener('input', updatePreview);
        document.getElementById('producerName').addEventListener('input', updatePreview);
        document.getElementById('projectDetails').addEventListener('input', updatePreview);
        
        // Initialize preview
        updatePreview();
    </script>
</body>
</html>